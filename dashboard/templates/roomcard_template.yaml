---
room_card:
  description: Room card with status and controls
  variables:
    - room_name
    - room_icon
    - area_id
    - temp_sensor
    - humid_sensor
    - nav_path
    - excluded_entities: []
    - light_entities: []
    - climate_entity
    - motion_sensor: null
    - media_player: null
  card:
    type: custom:vertical-stack-in-card
    cards:
      - type: custom:mushroom-template-card
        entity: "[[room_name]]"
        icon: "[[room_icon]]"
        icon_color: |
          {% set excluded = [[excluded_entities]] | tojson | from_json %}
          {% set entities = area_entities('[[area_id]]') %}
          {% set on_entities = entities
            | reject('in', excluded)
            | select('is_state', 'on')
            | list %}
          {% if on_entities | length > 0 %}
            #03A9F4
          {% else %}
            grey
          {% endif %}
        primary: "[[room_name]]"
        secondary: >-
          {{ states('[[temp_sensor]]') | round(0) }}Â°C | {{
          states('[[humid_sensor]]') | round(0) }}%
        layout: horizontal
        tap_action:
          action: navigate
          navigation_path: "[[nav_path]]"
        double_tap_action:
          action: navigate
          navigation_path: "[[nav_path]]"
        hold_action:
          action: toggle
        badge_icon: >
          {% if is_state_attr('[[climate_entity]]', 'hvac_action', 'heating') %}
            mdi:radiator
          {% elif is_state_attr('[[climate_entity]]', 'active_vicare_mode', 'standby') %}
            mdi:power-standby
          {% else %}
            mdi:thermometer
          {% endif %}
        badge_color: >
          {% if is_state_attr('[[climate_entity]]', 'hvac_action', 'heating') %}
            red
          {% elif is_state_attr('[[climate_entity]]', 'active_vicare_mode', 'standby') %}
            grey
          {% else %}
            #6c6c75
          {% endif %}
        card_mod:
          style:
            mushroom-state-info$: |
              .primary {
                font-size: 16px !important;
                position: relative;
                top: -50px;
                left: -155px;
                overflow: visible !important;
                white-space: normal !important;
              }
              .secondary {
                position: relative;
                overflow: visible !important;
                top: -52px;
                left: -155px;
              }
            mushroom-shape-icon$: |
              .shape {
                position: relative;
                left: -43px;
                top: 55px;
              }
            .: |
              :host {
                --mush-icon-size: 146px;
              }
            style: |
              mushroom-badge-icon {
                left: 69px;
                top: 25px;
              }

      - type: custom:mushroom-template-card
        primary: none
        icon_color: disabled
        icon: mdi:lightbulb
        secondary: none
        entity: "[[light_entities.0]]"
        tap_action:
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: Lampen [[room_name]]
              content:
                type: vertical-stack
                cards:
                  [[light_entities]]
              card_mod:
                style: |
                  ha-card {
                    --ha-card-border-width: 0;
                  }
        hold_action:
          action: toggle
        double_tap_action:
          action: more-info
        card_mod:
          style:
            mushroom-shape-icon$: |
            .: |
              ha-card {
                width: 66px;
                margin-left: 68%;
                top: -178px;
                background: none;
              }
              :host {
                --mush-icon-size: 38px;
              }

      - type: custom:mushroom-chips-card
        chips:
          [[chips]]
        card_mod:
          style:
            .: |
              ha-card {
                width: 66px;
                margin-left: 76%;
                top: -186px;
                background: none;
                --chip-border-width: 0;
              }
              :host {
                --mush-icon-size: 20px;
                --mush-chip-spacing: -2.9px
              }

    card_mod:
      style: |
        ha-card {
          height: 178px !important;
          width: 178px !important;
        }